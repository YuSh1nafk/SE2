<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="#{page.title.booking.details}">My Booking Detail</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 30px;
        background-color: #fff;
    }
    .booking-card {
        border: 1px solid #ebe8e8;
        margin-left: 40px;
        margin-right: 40px;
        padding: 40px;
        display: flex;
        gap: 30px;
        position: relative;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 10px 20px rgba(121, 75, 49, 0.15),
                    0 6px 6px rgba(121, 75, 49, 0.1);
        transition: all 0.3s ease;
    }
    .booking-image-container {
        flex: 0 0 220px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .booking-image {
        width: 420px;
        height: 265px;
        border-radius: 10px;
        object-fit: cover;
    }
    .payment-method {
        font-style: italic;
        font-size: 18px;
        color: #1E0E62;
        padding-top: 10px;
        text-align: center;
    }
    .payment-text {
        font-size: 18px;
    }
    .payment-instruction {
        font-weight: bold;
    }
    .booking-details {
        flex: 1;
        padding-left: 50px;
        margin: 0;
        list-style-type: none;
    }
    .booking-detail {
        margin-bottom: 12px;
        display: flex;
        align-items: flex-start;
        position: relative;
        padding-left: 20px;
    }
    .booking-detail::before {
        content: "•";
        position: absolute;
        left: 0;
        color: #000;
    }
    .detail-label {
        font-weight: none;
        width: 140px;
        flex-shrink: 0;
    }
    .detail-value {
        flex: 1;
    }
    .guests {
        display: flex;
        gap: 30px;
        align-items: center;
    }
    .guest-group {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .status-message {
        color: #EC711F;
        font-style: italic;
        font-weight: bold;
        font-size: 18px;
        margin: 15px 0;
        padding: 10px 10px 10px 30px;
        list-style-type: none;
        position: relative;
    }
    .status-message::before {
        content: "";
        position: absolute;
        left: 0.5px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        background-color: #EC711F;
        border-radius: 50%;
    }
    .cancel-btn-container {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
    }
    .cancel-btn {
        width: 100%;
        padding: 12px 16px;
        background-color: #794b31;
        color: white;
        white-space: nowrap;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 140px;
    }
    .cancel-btn:hover {
        background-color: #b08d7a;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(121, 75, 49, 0.3);
    }
    .cancel-btn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }
    .info-message {
        color: red;
        margin-top: 20px;
        margin-right: 40px;
        text-align: right;
    }
    .loading {
        display: none;
        margin-left: 10px;
    }
    .is-loading .loading {
        display: inline-block;
    }

    @media (max-width: 1200px) {
        .booking-card {
            flex-direction: column;
            padding: 30px;
        }
        .booking-image-container {
            flex: 1 1 auto;
            width: 100%;
        }
        .booking-image {
            width: 100%;
            height: auto;
            max-height: 400px;
        }
        .booking-details {
            padding-left: 0;
            padding-top: 20px;
        }
        .cancel-btn-container {
            position: static;
            transform: none;
            margin-top: 20px;
            text-align: center;
        }
        .cancel-btn {
            width: auto;
            display: inline-block;
        }
    }

    @media (max-width: 768px) {
        body {
            padding: 15px;
        }
        .booking-card {
            padding: 20px;
        }
        .booking-detail {
            flex-direction: column;
            align-items: flex-start;
        }
        .detail-label {
            width: auto;
            margin-bottom: 5px;
        }
        .guests {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        h1 {
            font-size: 32px;
            padding-bottom: 15px;
        }
    }

    @media (max-width: 480px) {
        .payment-method,
        .payment-text,
        .payment-instruction,
        .booking-detail,
        .status-message {
            font-size: 16px;
        }
        .booking-detail:first-child {
            font-size: 24px !important;
        }
    }
  </style>
</head>
<body>
<!-- Header Fragment -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- Main Content -->
<main class="my-5">
  <h1 th:text="#{page.header.booking.details}" style="text-align: center; font-size: 33px; color:#794b31; padding-bottom: 20px">My Booking Detail</h1>

  <div th:each="booking : ${bookings}" class="booking-card">

    <!-- Left Column - Image and Payment -->
    <div class="booking-image-container">
      <img th:src="${booking.room.photoUrl}"
           th:alt="${'Image of ' + booking.room.roomType}"
           class="booking-image">
      <div class="payment-method">
        <span class="payment-text">Payment method: </span>
        <span class="payment-instruction">Please pay at the counter.</span>
      </div>
    </div>

    <!-- Right Column - Booking Details as List -->
    <ul class="booking-details">
      <li class="booking-detail" style="color:#1E0E62; font-size: 22px; font-weight: bold">
        <span class="detail-label">Code:</span>
        <span class="detail-value" th:text="${booking.bookingConfirmationCode}"></span>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Name:</span>
        <span class="detail-value" th:text="${booking.guestFullName}" style="font-weight: bold"></span>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Phone:</span>
        <span class="detail-value" th:text="${'(+)' + booking.guestPhone}"></span>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Check-In Date:</span>
        <span class="detail-value" th:text="${#temporals.format(booking.checkInDate, 'yyyy/MM/dd')}" style="font-weight: bold"></span>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Check-Out Date:</span>
        <span class="detail-value" th:text="${#temporals.format(booking.checkOutDate, 'yyyy/MM/dd')}" style="font-weight: bold"></span>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Room Type:</span>
        <span class="detail-value" th:text="${booking.room.roomType}"></span>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Room Number:</span>
        <span class="detail-value" th:text="${booking.room.roomNumber}" style="color:#1E0E62; font-weight: bold"></span>
      </li>
      <li class="booking-detail guests">
        <div class="guest-group">
          <span class="detail-label" style="font-size: 16px">Adults:</span>
          <span class="detail-value" th:text="${booking.numOfAdults}"></span>
        </div>
        <div class="guest-group">
          <span class="detail-label" style="font-size: 16px">Children:</span>
          <span class="detail-value" th:text="${booking.numOfChildren}"></span>
        </div>
      </li>
      <li class="booking-detail">
        <span class="detail-label" style="font-size: 16px">Price:</span>
        <span class="detail-value" th:text="${'$' + #numbers.formatDecimal(booking.room.roomPrice, 1, 2)}" style="color:#1E0E62; font-weight: bold"></span>
      </li>
      <li class="status-message" th:text="${booking.status}"></li>
    </ul>

    <!-- Cancel Button - Vertically Centered -->
    <div class="cancel-btn-container">
      <button class="cancel-btn"
              th:text="#{button.cancel.booking}"
              th:disabled="${!booking.cancellable}"
              th:attr="aria-disabled=${!booking.cancellable}, aria-label=${#messages.msg('button.cancel.booking')}"
              th:onclick="'cancelBooking(\'' + ${booking.id} + '\', this)'">
        Cancel Booking
        <span class="loading">⌛</span>
      </button>
    </div>
  </div>

  <div class="info-message" th:if="${#lists.isEmpty(bookings.?[cancellable])}">
    <span th:text="#{message.booking.cancel.restriction}" >You can only cancel when the booking is pending verification</span>
  </div>
</main>

<!-- Footer Fragment -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script th:inline="javascript">
  function cancelBooking(bookingId, button) {
      if (confirm(/*[[#{dialog.confirm.cancel.booking}]]*/ 'Are you sure you want to cancel this booking?')) {
          button.classList.add('is-loading');
          button.disabled = true;

          fetch('/bookings/' + bookingId + '/cancel', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-Requested-With': 'XMLHttpRequest',
                  'X-CSRF-TOKEN': /*[[${_csrf.token}]]*/ ''
              }
          })
          .then(response => {
              if (response.ok) {
                  window.location.reload();
              } else {
                  alert(/*[[#{error.operation.failed}]]*/ 'Operation failed');
              }
          })
          .catch(error => {
              console.error('Error:', error);
              alert(/*[[#{error.network}]]*/ 'Network error occurred');
          })
          .finally(() => {
              button.classList.remove('is-loading');
              button.disabled = false;
          });
      }
  }
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'92c7f83e4f0b12ef',t:'MTc0NDAxMjYwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>